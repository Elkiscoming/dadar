{% load staticfiles %}
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="{% static 'css/materialize.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/main.css' %}"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>
<body class="grey lighten-2">

<div class="row">
    <div class="col l8 offset-l2">
        <div class="center-align">
            <div class="row">
                <a id="left-arrow" class="btn btn-floating cyan"><i class="large material-icons">chevron_left</i></a>
                <a class="btn btn-floating cyan"><i class="large material-icons">chevron_right</i></a>
                <a class="btn btn-floating red"><i class="large material-icons">favorite</i></a>
                <a class="btn btn-floating indigo"><i class="large material-icons">speaker_notes</i></a>
                <div id="images">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/jquery-2.1.4.min.js' %}"></script>
<script src="{% static 'js/materialize.js' %}"></script>
<script>
    var id;
    var num = 0;
    var preload = 4;
    var loadImage = function (number, isHidden) {
        $.get('image/' + id + '/' + number, function (data, status, xhr) {
            console.log('image' + number + ' loaded');
            var image = $('<img>');
            if (isHidden)
                image.hide();
            image.attr('src', data);
            image.attr('id', 'image' + number);
            image.attr('class', 'responsive-img');
            image.attr('data-roll', 'page');
            image.css('z-index', number);
            image.appendTo('#images');
        });
    };
    if (navigator.geolocation) { // device can return its location
        navigator.geolocation.getCurrentPosition(function (position) {
            console.log(position.coords.latitude);
            console.log(position.coords.longitude);
            console.log('init/' + position.coords.latitude + ',' + position.coords.longitude);
            $.get('init/' + position.coords.latitude + ',' + position.coords.longitude, function (data, status, xhr) {
                id = parseInt(data);
                loadImage(0, false);
                for (var i = 0; i < preload; i++)
                    loadImage(1 + i, true);
            });
        });
    }
    $('#left-arrow').click(function () {
        $('#image' + num).hide();
        num++;
        $('#image' + num).fadeIn("slow");
        loadImage(num + preload, true);
    });
</script>
</body>
</html>